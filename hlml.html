<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Robbery Search Minigame</title>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: #111;
      color: white;
      overflow: hidden;
    }

    /* Fullscreen background image */
    #fullscreen-image {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      z-index: -1;
    }

    #game {
      position: absolute;
      top: 20px;
      left: 20px;
      z-index: 2;
    }

    .key-box {
      display: flex;
      align-items: center;
      margin-bottom: 10px;
      font-size: 22px;
    }

    .key {
      background: #fff;
      color: #000;
      padding: 6px 14px;
      margin-right: 8px;
      border-radius: 4px;
      font-weight: bold;
      min-width: 40px;
      text-align: center;
    }

    /* Progress bar */
    #progress-container {
      position: absolute;
      bottom: 30px;
      right: 30px;
      display: none;
      font-size: 14px;
      font-weight: bold;
      color: white;
      background: rgba(0,0,0,0.6);
      padding: 6px 10px;
      min-width: 200px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      z-index: 2;
    }
    #progress-label { flex-shrink: 0; }
    #progress-bar-bg {
      flex-grow: 1;
      margin-left: 10px;
      height: 10px;
      background: rgba(255,255,255,0.1);
      overflow: hidden;
    }
    #progress-bar {
      height: 100%;
      width: 0%;
      background: #e02727;
      transition: width 0.15s linear;
    }

    #start-message { font-size: 22px; }
    .orange { color: orange; font-weight: bold; }
    .yellow { color: yellow; font-weight: bold; }
    .danger { color: red; font-weight: bold; }

    #stop-message {
      position: absolute;
      bottom: 60px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 20px;
      display: none;
      z-index: 2;
    }

    /* Timer */
    #timer {
      position: absolute;
      top: 20px;
      right: 30px;
      font-size: 22px;
      font-weight: bold;
      display: none;
      z-index: 2;
      color: white;
      transition: color 0.3s ease;
    }

    #final-time {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 28px;
      font-weight: bold;
      color: yellow;
      display: none;
      z-index: 3;
    }

    /* Loot messages right */
    #loot-messages-right {
      position: absolute;
      bottom: 100px;
      right: 30px;
      display: flex;
      flex-direction: column-reverse;
      align-items: flex-end;
      pointer-events: none;
      z-index: 2;
    }
    .loot-right {
      display: flex;
      align-items: center;
      background: rgba(0,0,0,0.8);
      border: 2px solid #4ab3ff;
      border-radius: 6px;
      padding: 6px 10px;
      margin-top: 6px;
      font-size: 18px;
      font-weight: bold;
      opacity: 0;
      transform: translateX(120%);
      animation: slideInRight 3s ease forwards;
      min-width: 280px;
    }
    .loot-icon {
      width: 18px;
      height: 18px;
      background: #4ab3ff;
      margin-right: 10px;
      border-radius: 3px;
    }
    .loot-right span { color: white; }
    @keyframes slideInRight {
      0%   { transform: translateX(120%); opacity: 0; }
      15%  { transform: translateX(0); opacity: 1; }
      85%  { transform: translateX(0); opacity: 1; }
      100% { transform: translateX(120%); opacity: 0; }
    }

    /* Loot feed left */
    #loot-messages-left {
      position: absolute;
      bottom: 100px;
      left: 30px;
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      pointer-events: none;
      z-index: 2;
    }
    .loot-left {
      font-size: 18px;
      margin-top: 6px;
      opacity: 0;
      transform: translateY(20px);
      animation: slideUpLeft 8s ease forwards;
    }
    .loot-left span { color: yellow; font-weight: bold; }
    @keyframes slideUpLeft {
      0%   { transform: translateY(20px); opacity: 0; }
      15%  { transform: translateY(0); opacity: 1; }
      85%  { transform: translateY(0); opacity: 1; }
      100% { transform: translateY(-20px); opacity: 0; }
    }
  </style>
</head>
<body>
  <img id="fullscreen-image" src="https://cdn.discordapp.com/attachments/1273303595412099150/1416002002630213632/image.png?ex=68c54221&is=68c3f0a1&hm=6d85d1822fe5ff8788196d619614adb530aa1f6134bc7d7e2de783cf22d1e89d&" alt="Overlay">

  <div id="game">
    <div id="start-message">
      Press <span class="key">E</span> to <span class="orange">break open</span> the <span class="yellow">Container</span>
    </div>
    <div id="instructions" style="display:none;">
      <div class="key-box">
        <div id="current-key" class="key">?</div>
        <span>to break in</span>
      </div>
      <div class="key-box">
        <div class="key">Esc</div>
        <span>to cancel</span>
      </div>
    </div>
  </div>

  <div id="progress-container">
    <span id="progress-label">Break in</span>
    <div id="progress-bar-bg"><div id="progress-bar"></div></div>
  </div>

  <div id="stop-message">Press <span class="key">E</span> to stop <span class="danger">breaking in</span></div>
  <div id="timer">00:00:000</div>
  <div id="final-time"></div>
  <div id="loot-messages-right"></div>
  <div id="loot-messages-left"></div>

  <script>
    const allKeys = [
      {name: "W", code: "KeyW"},
      {name: "A", code: "KeyA"},
      {name: "S", code: "KeyS"},
      {name: "D", code: "KeyD"},
      {name: "↑", code: "ArrowUp"},
      {name: "↓", code: "ArrowDown"},
      {name: "←", code: "ArrowLeft"},
      {name: "→", code: "ArrowRight"},
    ];

  const lootPool = [
  "Industrial Angle Grinder",
  "Industrial Towing Rope",
  "Industrial Insullation Roll",
  "Cable Roll",
  "Toolbox",
  "Laptop",
  "Circuit Board",
  "USB (SSO Key)",
  "Blast Charge",
  "Remote Explosives",
  "Gold Nugget",
  "Uncut Diamond (Large)",
  "Uncut Diamond (Medium)",
  "Uncut Diamond (Small)",
  "Five Seven",
  "Heavy Shotgun",
  "Switchblade",
  "Knuckle Duster",
  "M9 Barreta",
  "SNS Pistol",
  "Pistol MK2",
  "Uncut Sapphire",
  "Crowex Watch",
  "Uncut Ruby",
  "Crowex Pearl Necklace",
  "Crowex Earrings",
  "Designer Pants",
  "Designer Glasses",
  "Designer Shoes",
  "Designer Top",
  "Suitcase",
  "Designer Suitcase",
  "Widescreen TV",
  "DES Module",
  "Glass Cutter",
  "Industrial Drill",
  "Drill",
  "Industrial Ventilation Equipment",
  "Furr coat",
  "Suppressor (Mod)",
  "Crystal Meth Tray (Blue)",
  "Crystal Meth Tray (Green)",
  "Crystal Meth Tray (Clear)",
  "Crystal Meth Tray (Cloudy)",
  "Crystal Meth Tray (White)",
  "Ketamine Tray",
  "Meth Slab (Blue)",
  "Meth Slab (Green)",
  "Meth Slab (Clear)",
  "Meth Slab (Cloudy)",
  "Meth Slab (White)",
  "Cocaine (Block)",
  "Cocaine (Slab)",
  "Cocaine (Brick)",
  "Grip (Mod)",
  "Extended Mag (Mod)",
  "SMG Ammunation Box",
  "SMG Shell Casings",
  "Rifle Ammunation Box",
  "Rifle Shell Casings",
  "SMG Stock",
  "SMG Receiver",
  "SMG Barrel",
  "SMG Handguard",
  "Rifle Stock",
  "Rifle Receiver",
  "Rifle Handguard",
  "Rifle Barrel",
  "Blueprint (Weed Lockup)",
  "Blueprint (Coke lab)"
];


    let currentPair = [];
    let showingIndex = 0;
    let progress = 0;
    let intervalId = null;
    let running = false;

    let startTime = null;
    let timerInterval = null;

    const currentKeyEl = document.getElementById("current-key");
    const progressBar = document.getElementById("progress-bar");
    const progressContainer = document.getElementById("progress-container");
    const startMessage = document.getElementById("start-message");
    const instructions = document.getElementById("instructions");
    const stopMessage = document.getElementById("stop-message");
    const timerEl = document.getElementById("timer");
    const finalTimeEl = document.getElementById("final-time");
    const lootMessagesRight = document.getElementById("loot-messages-right");
    const lootMessagesLeft = document.getElementById("loot-messages-left");

    function pickPair() {
      let first = allKeys[Math.floor(Math.random() * allKeys.length)];
      let second;
      do { second = allKeys[Math.floor(Math.random() * allKeys.length)]; }
      while (second.code === first.code);
      currentPair = [first, second];
      showingIndex = 0;
      updateDisplay();
    }

    function updateDisplay() {
      currentKeyEl.textContent = currentPair[showingIndex].name;
    }

    function startTimer() {
      startTime = Date.now();
      timerInterval = setInterval(() => {
        let elapsed = Date.now() - startTime;
        let min = String(Math.floor(elapsed / 60000)).padStart(2, '0');
        let sec = String(Math.floor((elapsed % 60000) / 1000)).padStart(2, '0');
        let ms  = String(elapsed % 1000).padStart(3, '0');
        timerEl.textContent = `${min}:${sec}:${ms}`;
      }, 50); // update every 50ms
    }

    function stopTimer(showFinal=false, success=false) {
      clearInterval(timerInterval);
      timerInterval = null;
      if (showFinal) {
        finalTimeEl.textContent = "Time: " + timerEl.textContent;
        finalTimeEl.style.color = success ? "lime" : "red";
        finalTimeEl.style.display = "block";
        setTimeout(() => finalTimeEl.style.display = "none", 5000);
      }
    }

    function randomizeQuantity(item) {
      let match = item.match(/x(\d+)-x(\d+)/);
      if (match) {
        let min = parseInt(match[1]), max = parseInt(match[2]);
        let num = Math.floor(Math.random() * (max - min + 1)) + min;
        return item.replace(/x\d+-x\d+/, "x" + num);
      }
      return item;
    }

    function cleanName(item) {
      return item.replace(/x\d+/, "").replace(/x\d+-x\d+/, "").trim();
    }

    function showLoot() {
      const chosen = [];
      while (chosen.length < 4) {
        let item = lootPool[Math.floor(Math.random() * lootPool.length)];
        if (!chosen.includes(item)) chosen.push(item);
      }
      chosen.forEach(item => {
        const randomized = randomizeQuantity(item);
        const amountMatch = randomized.match(/x(\d+)/);
        const amount = amountMatch ? amountMatch[1] : "1";
        const name = randomized.replace(/x\d+/, "").trim();
        const elRight = document.createElement("div");
        elRight.className = "loot-right";
        elRight.innerHTML = `<div class="loot-icon"></div><span>+${amount} ${name.toUpperCase()}</span>`;
        lootMessagesRight.appendChild(elRight);
        setTimeout(() => lootMessagesRight.removeChild(elRight), 3000);
      });
      chosen.forEach((item, i) => {
        setTimeout(() => {
          const elLeft = document.createElement("div");
          elLeft.className = "loot-left";
          elLeft.innerHTML = `You found a <span>${cleanName(item)}</span>`;
          lootMessagesLeft.appendChild(elLeft);
          setTimeout(() => lootMessagesLeft.removeChild(elLeft), 8000);
        }, i * 600);
      });
    }

    function updateProgress(delta) {
      progress = Math.max(0, Math.min(100, progress + delta));
      progressBar.style.width = progress + "%";
      if (progress >= 100) {
        showLoot();
        stopTimer(true, true); // success = green
        stopGame();
      }
    }

    function startGame() {
      running = true;
      progress = 0;
      progressBar.style.width = "0%";
      startMessage.style.display = "none";
      instructions.style.display = "block";
      progressContainer.style.display = "flex";
      stopMessage.style.display = "block";
      timerEl.style.display = "block";
      timerEl.textContent = "00:00:000";
      startTimer();
      pickPair();
      intervalId = setInterval(() => pickPair(), 5000);
    }

    function stopGame(cancelled=false) {
      running = false;
      clearInterval(intervalId);
      intervalId = null;
      instructions.style.display = "none";
      progressContainer.style.display = "none";
      stopMessage.style.display = "none";
      timerEl.style.display = "none";
      stopTimer(cancelled, false); // cancel = red
      startMessage.style.display = "block";
    }

    document.addEventListener("keydown", (e) => {
      if (!running) {
        if (e.code === "KeyE") startGame();
        return;
      }
      if (e.code === "Escape" || e.code === "KeyE") {
        stopGame(true);
        return;
      }
      const currentKey = currentPair[showingIndex];
      if (e.code === currentKey.code) {
        updateProgress(0.15);
        showingIndex = showingIndex === 0 ? 1 : 0;
        updateDisplay();
      } else {
        updateProgress(-0.05);
      }
    });
  </script>
</body>
</html>

